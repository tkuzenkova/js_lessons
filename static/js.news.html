
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Java Script</title>
    <script type="text/javascript" src="script.js"></script>
    <style type="text/css">
        #banner {
            border: 5px solid pink;
            border-radius: 5px;
            background-color: pink; }
            img {
                width: 30%; 
                float: left;
                margin-right: 5px;
                border-radius: 10px;
            }
            .input {
                border: 5px solid #000;
                height: 200px;
                background-color: white;
                border-radius: 5px;
                overflow: hidden;
                padding: 5px;
            }
            #cursor{
                opacity:0;
            }

        </style>
    </head>
    <body>

        <div id="banner">
            <img src="http://s.pikabu.ru/images/previews_comm/2013-06_4/13715630446069.jpg">
            <div class="input" id="input">
                <span id="inputInner">test</span><span id="cursor">|</span>
            </div>
            
        </div>

<script type="text/javascript">

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

var news = ["Lorem Ipsum is\nsimply dummy", "It is a long established\nfact", "another text"];

var input = document.getElementById('inputInner');
var banner = document.getElementById('banner');
var cursor = document.getElementById('cursor');

var intervalInitial = 100,
    intervalFast = 20;
var interval = intervalInitial,
    i = 0,
    j = 0,
    writeLetter;
var onClickAllowed = true,
    removedChart = false;
input.innerHTML = '';


function writeNews(str) {

    writeLetter = setInterval(function () {

        if (i < news.length) {

            if (j < news[i].length) {

                var currentLetter = news[i][j];
                
                if ( onClickAllowed ) {
                    clearInterval(writeLetter);

                    if ( currentLetter == " " || currentLetter == "\n" ) {
                        interval = 500; 
                    } else {
                        interval = getRandomInt(50, 300);
                    }
                    //console.log(currentLetter + " " + interval);
                    writeNews();  
                } 

                if ( removedChart ) {

                    input.innerHTML = input.innerHTML.slice(0,input.innerHTML.length-1);
                    removedChart = false;

                } else if ( getRandomInt(1, 10) == 1 && onClickAllowed ) {

                    var codeCurrentLetter = currentLetter.charCodeAt(0);
                    var codeWrongLetter = currentLetter.charCodeAt(0) - getRandomInt(-2, 2);
                    input.innerHTML += String.fromCharCode(codeWrongLetter);
                    removedChart = true;

                }  else {

                    input.innerHTML += currentLetter;
                    j++;
                }
                
            } else {

                clearInterval(writeLetter);
                interval = intervalInitial;

                var beginNewStr = setTimeout(function () {

                    onClickAllowed = true;
                    writeNews();
                    i++;
                    j = 0;
                    input.innerHTML = '';

                }, 5000);
            }
        } else {
            i = 0;
            j = 0;
        }

    }, interval);

}

function finishStr() {
    if ( onClickAllowed ) {
        clearInterval(writeLetter);
        interval = intervalFast;
        writeNews();
        onClickAllowed = false;
        console.log("click interval =" + interval);
    }   
}

function blinkElement(){ 
    if ( cursor.style.opacity == '0' ) {
        cursor.style.opacity = '100';
    } else {
        cursor.style.opacity = '0';
    } 
    setTimeout(blinkElement,700); 
}


writeNews(news);
blinkElement();
banner.addEventListener('click', finishStr);



</script>

</body>
</html>
